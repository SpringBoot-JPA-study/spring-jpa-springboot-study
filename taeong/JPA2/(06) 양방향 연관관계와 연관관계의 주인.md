# 양방향 연관관계와 연관관계의 주인

🎯 테이블(외래키 사용)과 객체(참조 사용)의 패러다임 차이를 이해해야 양방향 연관관계에 대해서 이해할 수 있음!

<br>

## 테이블(외래키 사용)과 객체(참조 사용)의 패러다임 차이

- 양방향으로 매핑하는 경우에도 ‘테이블’에는 차이가 없음
    - 양쪽 테이블에서 연관관계를 조회하고 싶은 경우 **조인 쿼리**로 양쪽 테이블 조회 가능
    - 애초에 외래키 하나로 양방향이 다 있는 것 (사실상 방향이란 개념이 없음)
- 객체에서 연관관계를 사용하는 경우
    - 단방향 연관관계에서는 A→B만 연관관계를 확인할 수 있음 (B→A는 불가능)\
    - B→A를 확인하려면 B쪽에 A객체를 포함하는 리스트를 만들어줘야 함 ⇒ `‘양방향 객체 연관관계’`

<br><br>

## 1:N관계에서 매핑 방식
- N쪽(ex. MEMBER) : `@ManyToOne`

    ```java
    @ManyToOne
    @JoinColumn(name="TEAM_ID")    /*name에는 데이터베이스 외래키 컬럼명을 작성*/
    private Team team;
    ```

- 1쪽(ex. TEAM) : `@OneToMany`

    ```java
    @OneToMany(mappedBy="team")    /*mappedBy에는 반대편 연관 필드명을 작성*/
    private List<Member> members = new ArrayList<>();
    ```

- 💡 양쪽으로 참조할 수 있기는 하지만 객체는 가급적이면 단방향으로 참조하는 것이 좋음
    
<br><br>

## 연관관계의 주인과 mappedBy

- 데이터베이스는 외래키 하나로 양쪽 테이블을 조회 가능
- 객체는 양쪽 테이블을 조회하려면 두 개의 단방향 매핑 (= 양방향 매핑)을 수행해야함
- 그렇다면 어느 쪽 객체에서 외래키를 관리해야 할까??
    - ⇒ 연관관계의 주인이 외래키를 관리함

- **연관관계의 주인**
    - 주인 : 등록 및 수정 가능(외래키 관리)
    - 주인이 아닌 쪽(mappedBy속성 필요) : 읽기만 가능
- **외래키가 있는 곳을 주인으로 정해야 한다 = N쪽**
    - 리스트를 들고있는 쪽은 조회만 가능하도록
    - 1쪽을 주인으로 지정할 경우 데이터 흐름이 헷갈릴 수 있고 성능상의 문제가 발생할 우려가 있음


<br>


<img src="https://user-images.githubusercontent.com/48792230/213337268-0084ef7a-e7fd-4135-bc14-8c4a1a85657c.jpg" width="600"/>
