# 플러시

- 영속성 컨텍스트의 변경내용을 데이터베이스에 반영하는 것
- 보통 데이터베이스 트랜잭션이 커밋될 때 플러시가 일어남
- 쓰기 지연 SQL저장소에 쌓아놨던 SQL이 DB로 전달되는 것
- = 영속성 컨텍스트의 변경내역과 데이터베이스의 내용을 동기화시키는 작업
- 플러시가 발생하면
    1. 변경감지가 일어남
    2. 수정된 엔티티를 쓰기 지연 SQL저장소에 등록
    3. 쓰기 지연 SQL 저장소의 쿼리를 데이터베이스에 전송 (등록, 수정, 삭제 쿼리)
- 플러시를 한다고 해서 데이터베이스 트랜잭션이 커밋되는 건 아님
- 영속성 컨텍스트를 플러시하는 방법
    - 직접 호출 : em.flush()
    - 자동 호출
        - 트랜잭션 커밋
        - JPQL 쿼리 실행 : em.persist()만 수행한 상태에서 DB에 해당 엔티티를 조회하게 되면 에러 발생 → JPA에서는 이를 방지하기 위해 JPQL 쿼리가 실행시 플러시를 자동으로 호출해서 영속상태의 엔티티를 DB에 반영해버림
- 플러시를 한다고 해서 1차캐시(영속성 컨텍스트)를 비우는 것은 아님
    - 쓰기 지연 SQL 저장소(영속성 컨텍스트의 변경내용)의 내용들만 데이터베이스에 반영되는 것
- 트랜잭션이라는 작업 단위가 중요함 → 커밋 직전에만 동기화하면 됨
