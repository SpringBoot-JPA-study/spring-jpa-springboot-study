## MemberRepository

[@PersistenceContext](https://jaimemin.tistory.com/1898)

- EntityManagerì˜ persist ë©”ì„œë“œë¥¼ í†µí•´Â **ì—”í‹°í‹°ë¥¼ ì €ì¥**

<br>

### ì˜ì¡´ì„± ì£¼ì…

```java
@RequiredArgsConstructor    //@PersistenceContextë¥¼ ëŒ€ì²´í•¨
public class MemberRepository{
	
	private final EntityManager em;
	...
}
```

- ì›ë˜ ìŠ¤í”„ë§ì—ì„œ EntityManagerëŠ” ì˜ì¡´ì„± ì£¼ì…ì‹œì— Autowired ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
    - `@PersistenceContext` ì‚¬ìš©í•´ì•¼í•¨
- ê·¸ì¹˜ë§Œ ìŠ¤í”„ë§ë¶€íŠ¸ê°€ Autowiredë¥¼ ì§€ì›í•´ì¤˜ì„œ ìƒì„±ì ì£¼ì…ë„ ê°€ëŠ¥í•¨
- ìƒì„±ì ì£¼ì…ì„ @RequiredArgsConstructorê°€ í•¨
    - final í‚¤ì›Œë“œ ì§€ì •
    
    â‡’ Repositoryë„ Serviceì²˜ëŸ¼ ì¼ê´€ì„±ìˆê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
    

<br>

### JPQL ì‚¬ìš©

```java
//ê²€ìƒ‰
public List<Member> findByName(String name){
    return em.createQuery("select m from Member m where m.name = :name",Member.class)
            .setParameter("name",name)//íŒŒë¼ë¯¸í„°ì— ë°”ì¸ë”©
            .getResultList();
}
```

<br>

---

## MemberService

### *`@Transactional`*

- `import org.springframework.transaction.annotation.Transactional;`
- ë°ì´í„° ë³€ê²½ì€ í•­ìƒ íŠ¸ëœì­ì…˜ ë‚´ë¶€ì—ì„œ ì¼ì–´ë‚˜ì•¼ í•¨
- `@Transactional` ì„ ì‚¬ìš©í•˜ë©´ public ë©”ì†Œë“œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ íŠ¸ëœì­ì…˜ì´ ì ìš©ë¨

<br>

### *`@Transactional(readOnly = true)`*

- [ì¡°íšŒê°€ ì¼ì–´ë‚˜ëŠ” ê²½ìš° ì„±ëŠ¥ ìµœì í™”](https://willseungh0.tistory.com/75)
    - ì—”í‹°í‹°ê°€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ê´€ë¦¬ë¨ â‡’ 1ì°¨ ìºì‹œ + ë³€ê²½ ê°ì§€ ë“± ê¸°ëŠ¥ ì œê³µë¨
    - í•˜ì§€ë§Œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ë³€ê²½ ê°ì§€ë¥¼ ìœ„í•´ì„œ ìŠ¤ëƒ…ìƒ· ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë³´ê´€í•˜ë¯€ë¡œ ë” ë§ì€ ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ë‹¨ì ì´ ì¡´ì¬í•œë‹¤.
    - ê·¸ë˜ì„œ ì½ê¸° ì „ìš©ìœ¼ë¡œ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ë©´ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ìµœì í™”í•  ìˆ˜ ìˆë‹¤.
- ì½ê¸° ì „ìš©ì´ ì•„ë‹Œ ë©”ì†Œë“œì— `(readOnly = true)`ë¥¼ ë„£ìœ¼ë©´ ë°ì´í„°ë³€ê²½ì´ ì•ˆë˜ê¸° ë•Œë¬¸ì— ì£¼ì˜í•˜ì
    - íŠ¹ì • í´ë˜ìŠ¤ ë‚´ë¶€ì— ì½ê¸° ì „ìš© ë©”ì†Œë“œê°€ ë” ë§ë‹¤ë©´ í´ë˜ìŠ¤ëª… ë’¤ì— `@Transactional(readOnly = true)` ì˜µì…˜ì„ ì§€ì •í•˜ê³  ì½ê¸°ì „ìš©ì´ ì•„ë‹Œ ì»¤ë§¨ë“œì„± ë©”ì†Œë“œ ìœ„ì— ë³„ë„ë¡œ `@Transactional` ì˜µì…˜ì„ ì§€ì •í•œë‹¤. (ê¸°ë³¸ê°’ì€ falseì´ê¸° ë•Œë¬¸)

<br>

### [ì˜ì¡´ì„± ì£¼ì…](https://velog.io/@developerjun0615/Spring-RequiredArgsConstructor-%EC%96%B4%EB%85%B8%ED%85%8C%EC%9D%B4%EC%85%98%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%9C-%EC%83%9D%EC%84%B1%EC%9E%90-%EC%A3%BC%EC%9E%85)

- **ë°©ë²• 1) @Autowired ğŸ‘**
    
    ```java
    @Autowired  //-->ë³€ê²½ ë¶ˆê°€ëŠ¥ (ì• í”Œë¦¬ì¼€ì´ì…˜ ë™ì‘ ì‹œì— ì‚¬ìš©)
    private MemberRepository memberRepository;
    ```
    
    - ë³€ê²½ ë¶ˆê°€ëŠ¥ (ì• í”Œë¦¬ì¼€ì´ì…˜ ë™ì‘ ì‹œì— ì‚¬ìš©)
- **ë°©ë²• 2) setter injection ğŸ‘**
    
    ```java
    @Autowired
    public void setMemberRepository(MemberRepository memberRepository){
        this.memberRepository = memberRepository;
    }
    ```
    
    - ìŠ¤í”„ë§ì´ ë°”ë¡œ ì£¼ì…í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼ setterë¥¼ ì‚¬ìš©í•´ì„œ ì£¼ì…
    - ì¥ì  : í…ŒìŠ¤íŠ¸ì½”ë“œ ì‘ì„± ì‹œ, mockì„ ì§ì ‘ ì£¼ì…í•  ìˆ˜ ìˆìŒ
    - ë‹¨ì  : ëŸ°íƒ€ì„ì‹œì— ëˆ„êµ°ê°€ê°€ ë³€ê²½í•  ìœ„í—˜ì´ ìˆìŒ
- **ë°©ë²• 3) ìƒì„±ì injection ğŸ¤”**
    
    ```java
    public MemberService(MemberRepository memberRepository){
        this.memberRepository = memberRepository;
    }
    ```
    
    - ì¥ì 
        - ì¤‘ê°„ì— setterë¡œ ë³€ê²½í•  ìœ„í—˜ì´ ì—†ìŒ
        - í…ŒìŠ¤íŠ¸ì½”ë“œ ì‘ì„± ì‹œ mock ì£¼ì…ì„ ë†“ì¹˜ì§€ ì•Šê³  ì±™ê¸¸ ìˆ˜ ìˆìŒ
        - ì˜ˆì „ì—ëŠ” @Autowired ì„ ë¶™ì—¬ì•¼í–ˆëŠ”ë° ìš”ì¦˜ì—ëŠ” ì•ˆë¶™ì—¬ë„ ìŠ¤í”„ë§ì´ ì•Œì•„ì„œ injection ì œê³µ
    - ë‹¨ì  : ë³´ê¸° ì§€ì €ë¶„í•¨
- **ë°©ë²• 4) final í‚¤ì›Œë“œ ë¶™ì„ ğŸ‘**
    
    ```java
    private final *MemberRepository* memberRepository;
    
    public MemberService(MemberRepository memberRepository){
        this.memberRepository = memberRepository;
    }
    ```
    
    - `private final *MemberRepository* memberRepository;`
    - ëŸ°íƒ€ì„ ì‹œì—ëŠ” ë³€ê²½í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— finalë¡œ ì§€ì •
    - ì»´íŒŒì¼ ì‹œì ì— ìƒì„±ìì— ê°’ì´ ì˜ ì„¸íŒ…ë˜ì–´ìˆëŠ”ì§€ ì²´í¬í•´ì£¼ê¸° ë•Œë¬¸ì— ì•ˆì „í•¨
- **ë°©ë²• 5) @AllArgsConstructor ğŸ¤”**
    
    ```java
    public MemberService(MemberRepository memberRepository){
        this.memberRepository = memberRepository;
    }
    ```
    
    - ìœ„ì˜ ì½”ë“œë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ì–´ë…¸í…Œì´ì…˜
    - ê°€ë…ì„± ê°œì„  ê°€ëŠ¥
- **ë°©ë²• 6) @RequiredArgsConstructor ğŸ‘ğŸ‘**
    - `final`ì´ ë¶™ê±°ë‚˜Â `@NotNull`ì´ ë¶™ì€ í•„ë“œì˜ ìƒì„±ìë¥¼ ìë™ ìƒì„±

<br>

---

## MemberServiceTest

### fail()

- *`fail("ì˜ˆì™¸ê°€ ë°œìƒí•´ì•¼ í•œë‹¤.");`*
- fail()ì€ ìœ„ì—ì„œ ì´ë¯¸ ì˜ˆì™¸ê°€ í„°ì ¸ì•¼í•˜ëŠ” ìƒí™©ì„ ê¸°ëŒ€í•˜ëŠ” ê²½ìš°ì— ì‚¬ìš©í•˜ëŠ” ë©”ì†Œë“œ
- fail()ê¹Œì§€ ë‚´ë ¤ì˜¤ë©´ errorë¥¼ í„°ëœ¨ë¦¼

<br>

### ì˜ˆì™¸ì²˜ë¦¬

- *ë°©ë²•1) try-catch*
    
    ```java
    try{
        memberService.join(member2);    //ì˜ˆì™¸ ë°œìƒí•´ì•¼í•¨
    }catch (IllegalStateException e){
        return;
    }
    ```
    
- *ë°©ë²•2) @Test `expected ì˜µì…˜` ì‚¬ìš©*
    - *`@Test(expected = IllegalStateException.class)`*
    - ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ” ê²½ìš° *`IllegalStateException`*ìœ¼ë¡œ ì²˜ë¦¬
    

<br>

### *`@RunWith(SpringRunner.class)`*

- JUnit ì‹¤í–‰í•  ë•Œ springê³¼ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ê²½ìš°

<br>

### *`@SpringBootTest`*

- ìŠ¤í”„ë§ë¶€íŠ¸ë¥¼ ë„ìš´ ìƒíƒœë¡œ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•¨
- ì—†ìœ¼ë©´ @Autowired ì‹¤íŒ¨í•¨
