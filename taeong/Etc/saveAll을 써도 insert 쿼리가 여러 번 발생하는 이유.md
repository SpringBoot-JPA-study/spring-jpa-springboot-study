# **왜 saveAll을 써도 insert 쿼리는 여러 번 발생할까?**

### **왜 saveAll을 써도 insert 쿼리는 여러 번 발생할까?**

- saveAll을 사용하더라도, insert 쿼리가 한 번만 생성되는 것은 아닙니다. insert 쿼리가 여러 번 생성되는 이유는, **saveAll 함수가 내부적으로 Batch Insert 기능을 사용하기 때문입니다.** Batch Insert는 여러 개의 row를 연결해서 한 번에 입력하는 것으로, 하나의 트랜잭션으로 묶입니다. **따라서, saveAll 함수를 사용하면 여러 개의 row를 한 번에 처리할 수 있지만, 이 때 각 row마다 insert 쿼리가 생성됩니다.**
- 하지만 이는 여러 개의 insert 쿼리를 한 번에 실행함으로써, 데이터베이스와의 통신 횟수를 줄이고 성능을 향상시키는 장점이 있습니다. 따라서, saveAll 함수는 여러 개의 row를 한 번에 처리할 수 있기 때문에, 대용량 데이터를 처리할 때 유용하게 사용될 수 있습니다.

### saveAll 함수를 쓸 때 insert문을 한 번만 실행시키게 하려면 batch size를 변경해야한다

- 기본값으로 Hibernate에서는 JDBC Statement에서 일괄 처리할 수 있는 최대 데이터 수를 30으로 설정하고 있습니다.
- 기본적으로 saveAll 함수를 사용하면 처리할 데이터가 30개 미만인 경우에는 insert 쿼리가 한 번만 실행됩니다. 그러나 처리할 데이터가 30개 이상인 경우에는 일정한 크기로 나누어서 여러 번 insert 쿼리가 실행됩니다. 이 때, 일정한 크기는 Hibernate의 Batch Size 설정에 따라 달라집니다.
- 그러므로, saveAll 함수를 사용할 때 insert 쿼리를 한 번만 실행시키기 위해서는 Batch Size를 적절한 값으로 조정해주어야 합니다.
    - Batch Size를 크게 설정하면, insert 쿼리 실행 횟수를 줄일 수 있지만, 메모리 사용량이 증가할 수 있습니다.
    - 반대로, Batch Size를 작게 설정하면, 메모리 사용량을 줄일 수 있지만 insert 쿼리 실행 횟수가 증가하여 성능이 저하될 수 있습니다.
    - 따라서, 적절한 Batch Size를 설정하는 것이 중요합니다.
