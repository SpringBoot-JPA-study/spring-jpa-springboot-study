## 1. 멀티 스레드 , 멀티 프로세스

- 프로세스 : **컴퓨터에서 연속적으로 실행되고 있는 컴퓨터 프로그램,** 운영체제로부터 자원을 할당받는 작업의 단위
- 멀티 프로세스 : 두개 이상 다수의 프로세서(`CPU`)가 협력적으로 하나 이상의 작업(`Task`)을 동시에 처리하는 것 (병렬처리)
- 스레드 : 프로세스가 할당받은 자원을 이용하는 실행의 단위
- 멀티 스레드 : 하나의 프로세스에 여러 스레드로 자원을 공유하며 작업을 나누어 수행하는 것

<br>

### **멀티 스레드 vs 멀티 프로세스**

- 멀티 스레드는 멀티 프로세스보다 적은 메모리 공간을 차지하고 `Context Switching`이 빠른 장점이 있지만, 동기화 문제와 하나의 스레드 장애로 전체 스레드가 종료 될 위험을 갖고 있다.
- 멀티 프로세스는 하나의 프로세스가 죽더라도 다른 프로세스에 영향을 주지 않아 안정성이 높지만, 멀티 스레드보다 많은 메모리공간과 CPU 시간을 차지하는 단점이 있다.
- 두 방법은 동시에 여러 작업을 수행하는 점에서 동일하지만, 각각의 장단이 있으므로 적용하는 시스템에 따라 적합한 동작 방식을 선택하고 적용해야 한다.

[https://wooody92.github.io/os/멀티-프로세스와-멀티-스레드/#멀티-프로세스와-멀티-스레드-사용하는-이유](https://wooody92.github.io/os/%EB%A9%80%ED%8B%B0-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EB%A9%80%ED%8B%B0-%EC%8A%A4%EB%A0%88%EB%93%9C/#%EB%A9%80%ED%8B%B0-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EB%A9%80%ED%8B%B0-%EC%8A%A4%EB%A0%88%EB%93%9C-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0)

<br>

## 2. pcb , 컨텍스트 스위칭

- **프로세스 제어 블록(Process Control Block, PCB)** : 운영체제가 프로세스 스케줄링을 위해 프로세스에 관한 모든 정보를 가지고 있는 데이터베이스
    - 각 프로세스가 생성될 때마다 고유의 PCB가 생성되고, 프로세스가 완료되면 PCB는 제거
    - 컨텍스트 스위칭 수행을 위한 정보도 PCB에 저장됨
- **컨텍스트 스위칭** : 여러개의 프로세스가 실행되고 있을 때 기존에 실행되던 프로세스를 중단하고 다른 프로세스를 실행하는 것
    - 스레드 간에도 컨텍스트 스위칭이 일어날 수 있음

<br>

## 3. 공유 , 임계 영역 ,교착 상태→스핀락 , 뮤텍스 , 세마포어

- 멀티 스레드의 문제점 : 자원을 공유하기 때문에 동기화 문제가 발생할 수 있음 (병목현상, 데드락 등)
- 경쟁상태(Race Condition) : **여러 개의 프로세스가 공유 자원에 동시 접근할 때 실행 순서에 따라 결과값이 달라질 수 있는 현상**
    - 메모리를 공유하기 때문에 발생하며 동기화로 해결할 수 있다.
- 교착상태(=데드락(dead lock)) : 두 개 이상의 작업이 서로 상대방의 작업이 끝나기 만을 기다리고 있기 때문에 결과적으로 아무것도 완료되지 못하는 상태
    
    <img src="https://user-images.githubusercontent.com/48792230/222965541-aad5372d-6b2a-4b6a-8848-cd9573f4426c.jpg" width="400"/>
    
    - [교착상태의 발생 조건 4가지](https://cocoon1787.tistory.com/858#:~:text=%F0%9F%92%A3-,%EA%B5%90%EC%B0%A9%EC%83%81%ED%83%9C%EC%9D%98%20%EB%B0%9C%EC%83%9D%20%EC%A1%B0%EA%B1%B4%204%EA%B0%80%EC%A7%80,-%EA%B5%90%EC%B0%A9%EC%83%81%ED%83%9C%EB%8A%94%20%EC%95%84%EB%9E%98%EC%9D%98%204)
        - **상호 배제(Mutual Exclusion)**
            - 한 번에 한 개의 프로세스만이 공유자원을 사용할 수 있음
        - **점유 대기(Hold and Wait)**
            - 프로세스가 할당된 자원을 가진 상태에서 다른 자원을 기다림
        - **비선점(No Preemption)**
            - 프로세스가 작업을 마친 후 자원을 자발적으로 반환할 때까지 기다림(이미 할당된 자원을 강제적으로 빼앗을 수 없음)
        - **순환 대기(Circular Wait)**
            - 프로세스의 자원 점유 및 점유된 자원의 요구 관계가 원형을 이루면서 대기하는 조건.각 프로세스는 순환적으로 다음 프로세스가 요구하는 자원을 가지고 있음

<br>

## Critical Section (임계 영역)

- **임계구역**(Critical Section) : 공유 자원 접근 순서에 따라 실행 결과가 달라지는 프로그램의 영역
- **임계영역 문제의 해결책이 되기 위한 조건**
    1. 상호 배제 (Mutual Exclution)
        - 하나의 프로세스가 임계 영역에서 실행중이라면, 다른 프로세스는 해당 영역에 접근할 수 없어야 한다.
    2. 실행 (Process)
        - 임계 영역에서 실행중인 프로세스가 없을 때 들어가려는 프로세스가 여러 개라면 현재 대기중인 프로세스만이 진입 후보가 될 수 있고, 어느 것이 들어갈 것인지 결정해주어야 한다.
    3. 한정된 대기 (Bounded Waiting)
        - 프로세스가 임계영역에 들어가지 못하고 무한정 대기하는 상황이 발생하면 안된다.
        - 다른 프로세스들의 기아(Starvation)을 막기 위함이다.

<br>

### 동기화(synchronization)

- 여러 프로세스/스레드를 동시에 실행해도 공유 데이터의 일관성을 유지하는 것
- 동기화를 위한 여러 전략
    - **스핀 락(Spin lock)** : 임계 구역에 진입이 불가능할 때 진입이 가능할 때까지 루프를 돌면서 재시도하는 방식
        - 임계 구역 진입 전까진 루프를 계속 돌고 있기 때문에 busy waiting이 발생
        - 스핀 락은 운영체제의 스케줄링 지원을 받지 않기 때문에, 해당 스레드에 대한 문맥 교환(context switch)이 발생하지 않음
        - 문맥 교환이 일어나지 않기 때문에 멀티 프로세서 시스템에서만 사용 가능
    - **뮤텍스(Mutex)** : Locking 메커니즘으로 락을 걸은 스레드만이 임계 영역을 나갈 때 락을 해제할 수 있음
        - wait와 signal이라는 원자적 연산을 사용
        - 잠금 메커니즘이라는 점은 스핀 락과 동일하나 권한을 획득할 때까지 busy waiting 상태에 머무르지 않고 sleep 상태로 들어가고 wakeup 되면 다시 권한 획득을 시도하는 sleep lock을 사용
    - **세마포어(Semaphore)** : 음수가 아닌 정수 값을 가지고 스레드 간에 공유되는 변수를 사용
        - 락을 걸지 않은 스레드도 signal을 사용해 락을 해제할 수 있음
        - 세마포어는 사용할 수 있는 자원의 개수에 따라 이진 세마포어와 카운팅 세마포어로 구분함

[https://yoongrammer.tistory.com/63#스핀락(Spin_lock),_뮤텍스(Mutex),_세마포어(Semaphore)_알아보기](https://yoongrammer.tistory.com/63#%EC%8A%A4%ED%95%80%EB%9D%BD(Spin_lock),_%EB%AE%A4%ED%85%8D%EC%8A%A4(Mutex),_%EC%84%B8%EB%A7%88%ED%8F%AC%EC%96%B4(Semaphore)_%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0)
