# 2주차 - 도메인 분석 설계

## 👉🏻 엔티티 설계 Tip

- 엔티티 초기 설계시에는 단방향 관계만 설정하고, 개발을 진행하면서 필요한 경우에 양방향 관계를 추가하는 것이 좋다. → **`처음부터 양방향 관계로 설계할 필요 X`**
- 양방향 연관 관계 시 연관 관계 메서드를 통해 양쪽에 값을 넣어줘야한다.
- **`N:M 관계`** 는 실무에서 절대 쓰지 않는다.
  - 일대다, 다대일 관계로 풀어서 사용해야한다.
- db 컬럼명은 **`소문자 + _(언더 스코프)`** 형식으로 작성 (우형도 이 컨벤션을 따른다고 함)
- `1:N`, `N:1 관계`에서 연관관계의 주인은 외래키가 있는 곳이 된다.
  - `1:N 관계`에서 외래키는 무조건 N쪽에 존재한다.
  - 외래키가 있는 곳에서만 데이터 변경이 가능하고 반대쪽은 읽기만 가능하다.

## 🆚 즉시로딩 vs 지연로딩

- 즉시로딩: 엔티티 조회 시 연관된 엔티티를 함께 불러오는 방식 → `N + 1 문제 발생!`
  - `N + 1 문제`: 쿼리문 1개를 실행했을때 N개의 추가 쿼리가 실행되는 문제
- 지연로딩: 엔티티 조회 시 조회한 엔티티만 DB에서 가져오고 연관된 엔티티는 프록시 형태로 가져오는 방식
- 조회한 엔티티에 대한 쿼리 1개만 실행된다.
- 프록시 객체를 사용하는 시점에 초기화 → 이 시점에 DB에서 데이터를 가져와서 넣어준다.
  - 프록시 객체의 메서드나 필드를 사용할 때 초기화를 한다.
  - **`지연로딩은 연관된 엔티티를 프록시로 가져오는 방식`**
- `@XToOne` 관계는 기본이 즉시 로딩이기 때문에 지연 로딩 설정이 필요함!
- 실무에서는 **`지연 로딩 + 페치 조인`** 형태로 사용한다.

> 만약 연관된 엔티티를 자주 함께 사용한다면??

- 즉시 로딩(EAGER)으로 가져온다.
- `Fetch Join을 사용해서 한꺼번에 가져온다.`
